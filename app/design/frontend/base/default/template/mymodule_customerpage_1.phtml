<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    Adesh
 * @package     Mymodule_Customerpage
 * @author      Adesh
 * @Website     adeshsuryan.in
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
    <div class="dashboard">
        <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
        <div class="box-account box-info">
            <div class="box-head">
              <h2 style="margin-bottom: 1%;"><?php echo $this->__('My Family Members') ?></h2>
				 <?php $connection = Mage::registry('familyTable'); ?> 
				<!-- <h2><?php echo $num ?></h2> -->
            </div>
			
			<div class="fieldset">
              <h4><?php echo $this->__('Family Members') ?></h4>
			   <ul class="form-list">
				<table class="fieldset">
					<tr>
						  <th class="tableHead" >Name</th>
						  <th>Relation</th>		
						  <th style="width: 20%;">Edit/Delete</th>
					</tr>
					
					<?php foreach($connection as $arr_row): ?>
								<tr>
									  <td><?php echo $arr_row['name'];?></td>
									  <td><?php echo $arr_row['relation'];?></td>		
									  <td>
										<img src="<?php echo $this->getSkinUrl('images/btn_edit.png') ?>" onclick="editPage('<?php echo $arr_row['family_id'];?>')" style="width: 10%;cursor: pointer;" alt="Example ALT Text" />
										<img src="<?php echo $this->getSkinUrl('images/btn_delete.png') ?>" onclick="deletePage('<?php echo $arr_row['family_id'];?>')" style="width: 10%;cursor: pointer;" alt="Example ALT Text" />

									  </td>
								</tr>
					<?php endforeach; ?>
				</table>
				</ul>
            </div>
        </div>
    </div>
	
	<div style='display:none'>
				<div id='homepage_popup' style='padding:10px;'> 
					<!-- BEGIN #homepage-container --> 
					<form id='familyForm' action="<?php echo Mage::getUrl('family/index/update') ?>" method="post">
					<div id="formId1">
						<div class="fieldset">
							<h2 class="legend"><?php echo Mage::helper('contacts')->__('Information') ?></h2> 
							<ul class="form-list">
								<li class="fields" style="display: none;">
									<div class="field">
										<label class="required" for="family_id"><em>*</em></label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" title="family_id" value="" id="family_id" name="family_id" type="text">
											</div>
									</div>
								</li>
								<li class="fields">
									<div class="field">
										<label class="required" for="name"><em>*</em>First Name </label>
											<div class="input-box"> 
												<input class="input-text required-entry"  style="float:left;" title="Name" value="" id="name" name="name" type="text">
											</div>
									</div>
								</li>
								
								<li class="fields">
									<div class="field">
										<label class="required" for="sphere"><em>*</em>Sphere </label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" id="sphere" name="sphere" value="0" type="number" min="-10" max="10" step="0.25">
											</div>
									</div>
								</li>
								
								<li class="fields">
									<div class="field">
										<label class="required" for="cylinder"><em>*</em>Cylinder </label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" id="cylinder" name="cylinder" value="0" type="number" min="-4" max="4" step="0.25">
											</div>
									</div>
								</li>
								
								<li class="fields">
									<div class="field">
										<label class="required" for="axis"><em>*</em>Axis </label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" id="axis" name="axis" value="0" type="number" min="0" max="180" step="1">
											</div>
									</div>
								</li>
								<li class="fields">
									<div class="field">
										<label class="required" for="addition"><em>*</em>Addition (Add) </label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" id="addition" name="addition" value="0" type="number" min="0.75" max="3.5" step="0.25">
											</div>
									</div>
								</li>
								<li class="fields">
									<div class="field">
										<label class="required" for="pupillary"><em>*</em>Pupillary distance </label>
											<div class="input-box"> 
												<input class="input-text required-entry" style="float:left;" id="pupillary" name="pupillary" type="number" value="31.5"  min="23" max="43" step="0.5">
											</div>
									</div>
								</li>
								
							</ul>
						</div>
						
						<div class="buttons-set">
							<p class="required"><?php echo Mage::helper('contacts')->__('* Required Fields') ?></p>
							<input type="text" name="hideit" id="hideit" value="" style="display:none !important;" />
							<button type="submit"  title="<?php echo Mage::helper('contacts')->__('Save') ?>" class="button"><span><span><?php echo Mage::helper('contacts')->__('Save') ?></span></span></button>
						</div>
					</div>
					</form>
				</div>
			</div>	
			
			
			<div style='display:none'>
				<div id='deletepage_popup' style='padding:10px;'> 
					<!-- BEGIN #homepage-container --> 
					<form id='familyForm' action="<?php echo Mage::getUrl('family/index/delete') ?>" method="post" id="form-validate">
					<div id="formId1">
						<div class="fieldset">
							<h2 class="legend"><?php echo Mage::helper('contacts')->__('Are you sure you want to delete this Member') ?></h2> 
							<li class="fields" style="display: none;">
									<div class="field">
										<label class="required" for="delete_id"><em>*</em></label>
											<div class="input-box"> 
												<input class="input-text required-entry" class="input-text required-entry" style="float:left;" title="delete_id" value="" id="delete_id" name="delete_id" type="text">
											</div>
									</div>
								</li>
						</div>
						
						<div class="buttons-set">
							<p class="required"><?php echo Mage::helper('contacts')->__('* Required Fields') ?></p>
							<input type="text" name="hideit" id="hideit" value="" style="display:none !important;" />
							<button type="submit" id="deletePopUp" title="<?php echo Mage::helper('contacts')->__('Delete') ?>" class="button"><span><span><?php echo Mage::helper('contacts')->__('Delete') ?></span></span></button>
						</div>
					</div>
					</form>
				</div>
			</div>	
			
	
<style>
table,th,td{
	border:1px solid black;
	border-collapse:collapse;
}
th{
	padding:10px;
	padding-left: 20px;
	padding-right: 20px;
	text-align: center;
	font-weight: bold;
	font-size: 14px;
	background-color: #f8f8f8;
}
td{
	padding:5px;
	text-align: center;
}

</style>	

<script type="text/javascript">

var dataFormFamily = new VarienForm('familyForm', true);

	function deletePage(element) {	
		<?php foreach($connection as $arr_row): ?>
			<?php $profile_id = $arr_row['family_id'];?>
				if('<?php echo $profile_id ?>' == element){
					//alert('in if ...');
					jQuery("#delete_id").val(<?php echo $arr_row['family_id']; ?>);
				}
		<?php endforeach; ?>
		jQuery.colorbox({width:"580px", inline:true, href:"#deletepage_popup"});
	}

	function editPage(element) {	
		<?php foreach($connection as $arr_row): ?>
			<?php $profile_id = $arr_row['family_id'];?>
				if('<?php echo $profile_id ?>' == element){
					//alert('in if ...');
					jQuery("#family_id").val(<?php echo $arr_row['family_id']; ?>);
					jQuery("#name").val('<?php echo $arr_row['name']; ?>');
					jQuery("#sphere").val(<?php echo $arr_row['sphere']; ?>);
					jQuery("#cylinder").val(<?php echo $arr_row['cylinder']; ?>);
					jQuery("#axis").val(<?php echo $arr_row['axis']; ?>);
					jQuery("#addition").val(<?php echo $arr_row['addition']; ?>);
					jQuery("#pupillary").val(<?php echo $arr_row['pupillary']; ?>);
				}
		<?php endforeach; ?>
		jQuery.colorbox({width:"580px", inline:true, href:"#homepage_popup"});
	}
	jQuery(document).ready(function(){
		
		// $('closePopUp').observe('click', function(event) {
			// parent.jQuery.fn.colorbox.close();
		// });	
		
		// $('deletePopUp').observe('click', function(event) {
			// parent.jQuery.fn.colorbox.close();
		// });	
		
		if (document.cookie.indexOf('visited=true') == -1){
		  var fifteenDays = 1000*60*60*24*15; 
		  var expires = new Date((new Date()).valueOf() + fifteenDays);
		  document.cookie = "visited=true;expires=" + expires.toUTCString(); 
		  jQuery.colorbox({width:"600px", inline:true, href:"#homepage_popup"});
		  }
		if (document.cookie.indexOf('visited=true') == -1){
		  var fifteenDays = 1000*60*60*24*15; 
		  var expires = new Date((new Date()).valueOf() + fifteenDays);
		  document.cookie = "visited=true;expires=" + expires.toUTCString(); 
		  jQuery.colorbox({width:"600px", inline:true, href:"#deletepage_popup"});
		  }  
		  jQuery(".open_popup").colorbox({width:"580px", inline:true, href:"#homepage_popup"});
	});
	
</script>

